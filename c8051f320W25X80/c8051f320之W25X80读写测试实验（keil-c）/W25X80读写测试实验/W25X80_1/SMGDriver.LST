C51 COMPILER V8.08   SMGDRIVER                                                             09/02/2011 10:20:18 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE SMGDRIVER
OBJECT MODULE PLACED IN SMGDriver.OBJ
COMPILER INVOKED BY: D:\Keil for C8051\C51\BIN\C51.EXE SMGDriver.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //---------------------------------------------------------------------------------
   2          //
   3          //                                                                数码管驱动程序（.C）
   4          //                                                                      
   5          //                                                                                                                              
   6          //                                                        作者：赌神    2011年2月25日
   7          //---------------------------------------------------------------------------------
   8          
   9          #include <C8051F320.H>
  10          
  11          //=================================================================================
  12          //                                   数码管预定义
  13          //=================================================================================
  14          
  15          //数码管控制接口定义
  16          sbit SMG1_SELECT  =  P2^0;  //第一位数码管控制位
  17          sbit SMG2_SELECT  =  P2^1;  //第二位数码管控制位
  18          sbit SMG3_SELECT  =  P2^2;  //第三位数码管控制位
  19          sbit SMG4_SELECT  =  P2^3;  //第四位数码管控制位
  20          
  21          //595的控制接口定义
  22          sbit SPI_STCP   =   P2^4;               
  23          sbit SPI_SHCP   =   P1^3;               
  24          sbit SPI_DS             =   P1^2;
  25          
  26          //常量定义
  27          unsigned char code shuzi[]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,
  28                                0x80,0x90,0x88,0x83,0xc6,0xa1,0x86,0x8e};
  29          
  30          //------------------------------------------------------------------------------------------
  31          //=================================================================================
  32          //                                   内部函数定义
  33          //=================================================================================
  34          //---------------------------------------------------
  35          //函数功能：向595传输要显示的数据
  36          //---------------------------------------------------
  37          static void txData(unsigned char dat)
  38          {
  39   1              unsigned char i;
  40   1          SPI_STCP=0;
  41   1          for(i=0;i<8;i++)
  42   1          {
  43   2                      SPI_SHCP=0;
  44   2                      if (dat &0x80) 
  45   2                              SPI_DS=1;
  46   2                      else 
  47   2                              SPI_DS=0;
  48   2                      dat <<= 1;
  49   2                      SPI_SHCP=1;
  50   2          }
  51   1          SPI_STCP=1;
  52   1      }
  53          //------------------------------------------------------------------------------------------
  54          //=================================================================================
  55          //                                   接口函数定义
C51 COMPILER V8.08   SMGDRIVER                                                             09/02/2011 10:20:18 PAGE 2   

  56          //=================================================================================
  57          //---------------------------------------------------
  58          //函数功能：配置交叉开关，设置输入输出方式
  59          //---------------------------------------------------    
  60          void SMG_Port_Init()
  61          {                   
  62   1              P2MDOUT |= 0x1F;
  63   1              P1MDOUT |= 0x0E;                   
  64   1          XBR0        = 0x00;                                             
  65   1              XBR1    = 0x40;
  66   1              P2 &= 0xF0;
  67   1              P1 &= 0xFD;                                      
  68   1      }
  69          //---------------------------------------------------
  70          //select的低四位控制数码管位选，为1则选中。data是要显示的数值，范围：0-F
  71          //返回值为0操作失败，其他操作成功
  72          //---------------------------------------------------
  73          unsigned char lightSMG(unsigned char select,unsigned char dat)
  74          {
  75   1              SMG1_SELECT=0;
  76   1              SMG2_SELECT=0;
  77   1              SMG3_SELECT=0;
  78   1              SMG4_SELECT=0;
  79   1              if(select & 0x01)
  80   1                      SMG1_SELECT=1;
  81   1              if(select & 0x02)
  82   1                      SMG2_SELECT=1;
  83   1              if(select & 0x04)
  84   1                      SMG3_SELECT=1;
  85   1              if(select & 0x08)
  86   1                      SMG4_SELECT=1;
  87   1              txData(shuzi[dat]);
  88   1              return 1;
  89   1      }
  90          //------------------------------------------------------------------------------------------


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     92    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
